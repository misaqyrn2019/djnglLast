{% load static %}
{% load crispy_forms_tags %}

<div class="modal fade" id="myModelSupplier" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body">
                <input type="text" class="textinput textInput form-control" required id="SUPName"/>
             
                <input type="button" class="btn btn-success" id="SaveSupplier" value="ثبت"/>
			</div>
			<div class="modal-footer">
			<button type="button" class="btn btn-danger" data-dismiss="modal">بستن</button>
			</div>
		</div>
	</div>
</div>
<label style="opacity:0;" id="LBlSupplier">{{object.IdSupplier.Id}}</label>
<script>
    var LOC = location.href.toString().search("update")
    function Supplier()
    {
        $.ajax({
			url: '{% url 'inventory:APISupplierCreate' %}',
			type: 'GET',
			dataType:"json",
			contentType:"application/json;charset=utf-8",
			beforeSend: function (xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
			},
			success: function (arg) {
				$('#id_IdSupplier').empty()
				for (let i = 0; i < arg.length; i++)
				{
					if(LOC != -1)
					{
                        var LBlSupplier = document.getElementById("LBlSupplier").innerHTML
						if(arg[i].Id == parseInt(LBlSupplier))
							$('#id_IdSupplier').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
						else
							$('#id_IdSupplier').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
					}
					else
                    {
                        if(i == arg.length-1)
						    $('#id_IdSupplier').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                        else
                            $('#id_IdSupplier').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                    }
				}
			},
			error:function(error){
				alert("56-خطایی رخ داد!");
			}
		});
    }
    $(document).ready(function(){
        Supplier()
    });
    $('#SaveSupplier').click(function(){
            var Name = $('#SUPName').val()

			$.ajax({
				url: '{% url 'inventory:APISupplierCreate' %}',
				type: 'POST',
				dataType:"json",
				contentType:"application/json;charset=utf-8",
				beforeSend: function (xhr, settings) {
					xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
				},
				data:JSON.stringify({'Name':Name}),
				success: function (arg) {
                    Supplier()
					$('#myModelSupplier').modal('hide')
					$(".modal-backdrop").remove();
				},
				error:function(error){
                    alert("59-خطایی رخ داده است!")
				}
			});
        });

</script>