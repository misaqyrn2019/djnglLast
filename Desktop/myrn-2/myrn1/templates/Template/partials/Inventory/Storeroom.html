{% load static %}
{% load crispy_forms_tags %}

<div class="modal fade" id="myModelStoreroom" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body">
                <div id="div_id_Name" class="form-group">
                    <label for="id_Name" class=" requiredField">
                        نام انبار<span class="asteriskField">*</span>
                    </label>
                    <div class="">
                        <input type="text" maxlength="100" class="textinput textInput form-control" required="" id="SRName">
                    </div>
                </div>
                {% include 'Template/partials/CityProvince.html' %}
                <div id="div_id_Telephone" class="form-group">
                    <label for="id_Telephone" class=" requiredField">
                        شماره تلفن<span class="asteriskField">*</span>
                    </label>
                    <div class="">
                        <input type="text" maxlength="100" class="textinput textInput form-control" required="" id="Telephone">
                    </div>
                </div>
                <div id="div_id_Address" class="form-group">
                    <label for="id_Address" class=" requiredField">
                        آدرس<span class="asteriskField">*</span>
                    </label>
                    <div class="">
                        <input type="text" maxlength="100" class="textinput textInput form-control" required="" id="Address">
                    </div>
                </div>
                <div class="">
                    <select name="status" class="select form-control" id="status">
                        <option value="A" selected="">فعال</option>
                        <option value="N">غیرفعال</option>
                    </select>
                </div>                
                <input type="button" class="btn btn-success" id="SaveStoreroom" value="ثبت"/>
			</div>
			<div class="modal-footer">
			<button type="button" class="btn btn-danger" data-dismiss="modal">بستن</button>
			</div>
		</div>
	</div>
</div>
<label style="opacity:0;" id="LBlStoreroom">{{object.IdStoreroom.Id}}</label>
<script>
    var LOC = location.href.toString().search("update")
    function Storeroom()
    {
        $.ajax({
			url: '{% url 'inventory:APIStoreroomListCreate' %}',
			type: 'GET',
			dataType:"json",
			contentType:"application/json;charset=utf-8",
			beforeSend: function (xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
			},
			success: function (arg) {
				$('#id_IdStoreroom').empty()
				for (let i = 0; i < arg.length; i++)
				{
					if(LOC != -1)
					{
                        var LBlStoreroom = document.getElementById("LBlStoreroom").innerHTML
						if(arg[i].Id == parseInt(LBlStoreroom))
							$('#id_IdStoreroom').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
						else
							$('#id_IdStoreroom').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
					}
					else
                    {
                        if(i == arg.length-1)
						    $('#id_IdStoreroom').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                        else
                            $('#id_IdStoreroom').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                    }
				}
			},
			error:function(error){
				alert("78-خطایی رخ داد!");
			}
		});
    }
    $(document).ready(function(){
        Storeroom()
    });
    $('#SaveStoreroom').click(function(){
            var Name = $('#SRName').val()
            var Telephone = $('#Telephone').val()
            var status = $('#status').val()
            var Address = $('#Address').val()            
            var IdCity = $('#IdCity').val()

			$.ajax({
				url: '{% url 'inventory:APIStoreroomListCreate' %}',
				type: 'POST',
				dataType:"json",
				contentType:"application/json;charset=utf-8",
				beforeSend: function (xhr, settings) {
					xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
				},
				data:JSON.stringify({'Name':Name,
                                     'Telephone':Telephone,
                                     'status':status,
                                     'Address':Address,
                                     'IdCity':IdCity,
                                }),
				success: function (arg) {
                    Storeroom()
					$('#myModelStoreroom').modal('hide')
					$(".modal-backdrop").remove();
				},
				error:function(error){
                    alert("خطایی رخ داده است!")
				}
			});
        });

</script>