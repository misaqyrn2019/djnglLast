{% load static %}
{% load crispy_forms_tags %}

<div class="modal fade" id="myModelUnitofMeasurement" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body">
                <input type="text" class="textinput textInput form-control" required id="UOMName"/>
             
                <input type="button" class="btn btn-success" id="SaveUnitofMeasurement" value="ثبت"/>
			</div>
			<div class="modal-footer">
			<button type="button" class="btn btn-danger" data-dismiss="modal">بستن</button>
			</div>
		</div>
	</div>
</div>
<label style="opacity:0;" id="LBlUnitofMeasurement">{{object.IdUnitofMeasurement.Id}}</label>
<script>
    var LOC = location.href.toString().search("update")
    function UnitofMeasurement()
    {
        $.ajax({
			url: '{% url 'inventory:APIUnitofMeasurementCreate' %}',
			type: 'GET',
			dataType:"json",
			contentType:"application/json;charset=utf-8",
			beforeSend: function (xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
			},
			success: function (arg) {
				$('#id_IdUnitofMeasurement').empty()
				for (let i = 0; i < arg.length; i++)
				{
					if(LOC != -1)
					{
                        var LBlUnitofMeasurement = document.getElementById("LBlUnitofMeasurement").innerHTML
						if(arg[i].Id == parseInt(LBlUnitofMeasurement))
							$('#id_IdUnitofMeasurement').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
						else
							$('#id_IdUnitofMeasurement').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
					}
					else
                    {
                        if(i == arg.length-1)
						    $('#id_IdUnitofMeasurement').append("<option selected value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                        else
                            $('#id_IdUnitofMeasurement').append("<option value='" + arg[i].Id + "'>" + arg[i].Name + "</option>")
                    }
				}
			},
			error:function(error){
				alert("56-خطایی رخ داد!");
			}
		});
    }
    $(document).ready(function(){
        UnitofMeasurement()
    });
    $('#SaveUnitofMeasurement').click(function(){
            var Name = $('#UOMName').val()

			$.ajax({
				url: '{% url 'inventory:APIUnitofMeasurementCreate' %}',
				type: 'POST',
				dataType:"json",
				contentType:"application/json;charset=utf-8",
				beforeSend: function (xhr, settings) {
					xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
				},
				data:JSON.stringify({'Name':Name}),
				success: function (arg) {
                    UnitofMeasurement()
					$('#myModelUnitofMeasurement').modal('hide')
					$(".modal-backdrop").remove();
				},
				error:function(error){
                    alert("79-خطایی رخ داده است!")
				}
			});
        });

</script>