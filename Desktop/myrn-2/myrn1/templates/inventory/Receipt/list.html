{% extends 'Template/base.html' %}

{% block title %}{% block title-meta %}
	لیست فاکتور خرید/فروش
{% endblock %}{% endblock %}

{% block Create %}
    <a class="badge text-primary" href="{% url 'inventory:Receipt-Create' %}">تعریف فاکتور</a>
{% endblock %}


{% block main %}
    {% if object_list %}
    <table id="TBLScript" class="table table-striped display table-bordered tableResponse responsive" style="width:100%">
        <thead>
            <tr>
                <th>ردیف</th>
                <th>کالا</th>
                <th>واحد سنجش</th>
                <th>تعداد</th>
                <th>مبلغ</th>
                <th>تخفیف</th>
                <th>مالیات</th>
                <th>تاریخ فاکتور</th>
                <th>مشتری</th>
                <th>انبار</th>
                <th>نوع</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
        {% for item in object_list %}
            <tr>
                <td data-label="ردیف">{{item.Id}}</td>
                <td data-label="کالا">{{item.IdCommodity}}</td>
                <td data-label="واحد سنجش">{{item.IdUnitofMeasurement}}</td>
                <td data-label="تعداد">{{item.Count}}</td>
                <td data-label="مبلغ">{{item.Amount}}</td>
                <td data-label="تخفیف">{{item.Discount}}</td>
                <td data-label="مالیات">{{item.Taxation}}</td>
                <td data-label="تاریخ فاکتور">{{item.jDate}}</td>
                <td data-label="مشتری">{{item.IdCustomer}}</td>
                <td data-label="انبار">
                    {% if item.Type == 'B' %}
                        <a href="{% url 'inventory:Receipt-ReportStoreroomBuy' item.IdStoreroom.Id %}" target="_blank">
                            {{item.IdStoreroom}}
                        </a>
                    {% elif item.Type == 'S' %}
                        <a href="{% url 'inventory:Receipt-ReportStoreroomSale' item.IdStoreroom.Id %}" target="_blank">
                            {{item.IdStoreroom}}
                        </a>
                    {% endif %}
                </td>
                <td data-label="نوع">
                    {% if item.Type == 'B' %}
                        <p>خرید</p>
                    {% elif item.Type == 'S' %}
                        <p>فروش</p>
                    {% endif %}
                </td>
                <td data-label="عملیات">
                    {% if user.is_superuser or user.is_storekeeper %}
                    <a class="badge text-danger" href="{% url 'inventory:Receipt-Delete' item.pk %}">حذف</a>
                    <a class="badge text-succsess" href="{% url 'inventory:Receipt-update' item.pk %}">ویرایش</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>
    </table>
    {% else %}
    <div style="min-height:200px;">
        <P class="text-center">
            لیست فاکتور خالی است
            <br>
            <a href="{% url 'inventory:Receipt-Create' %}">
                تعریف فاکتور
            </a>
        </P>
    </div>
    {% endif %}
{% endblock %}

{% block JS %}
<script>
    $(document).ready(function(){
            function fn(){
                $("#A1").select2();
                $("#A2").select2();
                $("#A3").select2();
                $("#A4").select2();
                $("#A5").select2();
                $("#A6").select2();
                $("#A7").select2();
                $("#A8").select2();
                $("#A9").select2();
                $("#A10").select2();
            };
            $('#TBLScript').DataTable({
            initComplete: function () {
                this.api().columns([1,2,3,4,5,6,7,8,9,10]).every( function (ee) {
                    var column = this;
                    var select = $('<select style="width:100% !important" id="A'+ ee +'"><option value=""></option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
                            column
                                .search(val ? '^'+val+'$' : '', true, false)
                                .draw();
                        });
                    column.data().unique().sort().each( function ( d, j ) {
                        select.append('<option value="'+d+'">'+d+'</option>')
                    });
                    fn();
                });
            }
            });
        });
</script>
{% endblock %}